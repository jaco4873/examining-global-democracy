---
title: "Democracy & Macroeconomics"
author: "Jacob Lillelund"
date: "2023-02-28"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Set working directory
knitr::opts_knit$set(root.dir = "/Users/jacoblillelund/Documents/applied-social-science/data")

library(readxl)
library(janitor)
library(tidyverse)
```

# Load and clean data
```{r}
### FREEDOM HOUSE ###
# import and clean
freedomhouse <- read_excel("All_data_FIW_2013-2022.xlsx", sheet = 2, skip = 1, col_names = TRUE)
freedomhouse <- freedomhouse %>% 
  clean_names() %>%                                            # tidy data with janitor-package
  rename(country = country_territory, year = edition ) %>%     # rename columns
  select(c("country", "region", "c_t", "year", "pr", "cl", "total"))  # select relevant columns

### DEMOCRACY MATRIX RANKING ###
democracy_matrix <- read_excel("democracy-matrix-ranking.xlsx", skip = 1, col_names = TRUE)
democracy_matrix <- democracy_matrix %>% 
  clean_names() %>%                  # tidy data with janitor-package
  select(country, total_value_index) # select columns

### MACROECONOMIC VARIABLES ###
# Import and clean
worlddatabank <- read_csv("worlddatabank.csv",show_col_types = FALSE) %>%  
  rename_at(vars(5:11), ~ substr(., 1, 4)) %>%   # rename "year"-columns
  mutate_at(vars(5:11), as.integer) %>%          # convert observations to integers
  select(-c("Country Code")) %>%                 # exclude irrelevant column(s)
  rename("country" = "Country Name", economic_variable = "Series Name")
  
# create long-format-version
worlddatabank_long <- pivot_longer(worlddatabank, 
  cols = 4:10, names_to = "year", values_to = "value") %>% # create long format on year variable
  mutate(year = as.integer(year))

# Write CSV files for Python
  # write.csv(freedomhouse, "freedomhouse.csv", row.names = FALSE)
  # write.csv(worlddatabank, "worlddatabank_clean.csv", row.names = FALSE)
  # write.csv(worlddatabank_long, "worlddatabank_clean_long.csv", row.names = FALSE)

# Dirty_cat merging in Python - Open Provided Python Script

# Load Python dataset
  
### Create subsets of data ###

# EEA Subset
# define EEA countries in a vector
eea <- c()

```

# Compare democracy-indexes
```{r}
# Merge dataframes
index_comparison <- freedomhouse %>% filter(year == 2020) %>% 
  left_join(democracy_matrix, by = "country") %>% 
  select(country, total, total_value_index) %>%  # select relevant columns
  filter(!is.na(total_value_index)) %>% # filter for rows with missing values (territories are not included in Democracy Matrix ranking)
  mutate(total_value_index = total_value_index/10) # scale the democracy ranking to 0-100 from 0-1000

# Draw Scatterplot
index_comparison %>% 
  ggplot(aes(x = total, y = total_value_index, label = country)) +
  geom_text() +
  geom_smooth(method = "lm", se = FALSE)

# Check correlation
cor(index_comparison$total, index_comparison$total_value_index)
```

# Exploratory Data Analysis
```{r}

```

