---
title: "assumption checking"
author: "Hugo von Essen-MÃ¼ller"
date: "2023-05-23"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Check for multicollinearity between variables
Checking for multicollinearty between the variables is vital as it would impair our research if there was collinearity between variables, as collinear variables can predict each other. 

We test multicollinearity using the Variance Inflation Factor (VIF), VIF tests the correlation between the independent variables and the strength of that correlation. It is predicted by regressing a variable against every other variable, and explains how well the variable is explained by other variables. Variance inflation factor is calculated as 1 divided by the tolerance. The tolerance is the percent of variance in the variable that cannot be accounted for by other variables and is calculated as 1 minus R squared. The VIF score starts at 1 and has no upper limit, a value of 1 indicates that there is no correlation between variables and therefore no collinearity. A score between 1 and 5 suggests a moderate collinearity, but not enough to take corrective action. Above 5 is serious and warrants corrective measures, as the severity of the potential problems increase.
```{r}
# remove non-numeric variables, that are irrelevant for collinearity analysis
worlddatabank_2020_numeric <- worlddatabank_2020 %>% select(-c("country", "unique_key_1"))
names(worlddatabank_2020_numeric)

```


## Checking normality of the model using QQ-plot, Shapiro-Wilk test and Anderson-Darling test
```{r}
# Visualize histogram of residuals
hist(resid(democracy_score_model_norm))

# Visualize Q-Q plot of residuals
qqnorm(resid(democracy_score_model_norm))
qqline(resid(democracy_score_model_norm))

# Perform Shapiro-Wilk test
shapiro.test(resid(democracy_score_model_norm))

# Perform Anderson-Darling test
library(nortest)
ad.test(resid(democracy_score_model_norm))
```

## Checking homoscedasticity using a studentized Breusch-Pagan test and plotting the residuals vs predicted values
```{r}
# Plot residuals against predicted values
plot(predict(democracy_score_model_norm), resid(democracy_score_model_norm))

# Perform Breusch-Pagan test
library(lmtest)
bptest(democracy_score_model_norm)
```

## Checking linearity using the Cook-Weisberg test, in addition to the previously completed plots of the data
```{r}
# Perform Cook-Weisberg test
library(lmtest)
ncvTest(democracy_score_model_norm)
```

## Checking for outliers using Cook's distance
```{r}
cooks.distance(democracy_score_model_norm)

# Plot Cook's distance
plot(cooks.distance(democracy_score_model_norm), pch = 20, main = "Cook's distance")
abline(h = 4/length(worlddatabank_numeric), col = "red")
```


## Check for multicollinearity between variables
Checking for multicollinearty between the variables is vital as it would impair our research if there was collinearity between variables, as collinear variables can predict each other. 

We test multicollinearity using the Variance Inflation Factor (VIF), VIF tests the correlation between the independent variables and the strength of that correlation. It is predicted by regressing a variable against every other variable, and explains how well the variable is explained by other variables. Variance inflation factor is calculated as 1 divided by the tolerance. The tolerance is the percent of variance in the variable that cannot be accounted for by other variables and is calculated as 1 minus R squared. The VIF score starts at 1 and has no upper limit, a value of 1 indicates that there is no correlation between variables and therefore no collinearity. A score between 1 and 5 suggests a moderate collinearity, but not enough to take corrective action. Above 5 is serious and warrants corrective measures, as the severity of the potential problems increase.
```{r}
# remove non-numeric variables, that are irrelevant for collinearity analysis
worlddatabank_2020_numeric <- worlddatabank_2020 %>% select(-c("country"))

names(worlddatabank_2020_numeric)

```

```{r}
calculate_vif <- function(data) {
  
  predictors <- names(data)[sapply(data, is.numeric)]
  
  vif_results <- data.frame(variable = character(),
                             vif = double(),
                             stringsAsFactors = FALSE)
  
  for (p in predictors) {
    vif_value <- vif(lm(paste(p, "~ .", sep = ""), data = data))
    vif_results <- bind_rows(vif_results, tibble(variable = p,
                                                 vif = vif_value
                                                 ))
  }
  
  return(vif_results)
}

my_vif_results <- calculate_vif(worlddatabank_2020_numeric)

my_vif_results <- unstack(my_vif_results, form=vif~variable)

for (i in seq_along(names(worlddatabank_2020_numeric)[-1])) {
  rownames(my_vif_results)[i] <- names(worlddatabank_2020_numeric)[-1][i]
}
```

```{r}
# Make a matrix of all VIF scores
vif_matrix <- cbind(my_vif_results)

corr_table_vif <- vif_matrix %>%
  as.data.frame() %>%
  round(2) %>%
  kable(format = "html", digits = 2, caption = "VIF Matrix") %>%
  kable_styling(bootstrap_options = c("hover", full_width = F))

print(corr_table_vif)
```
As all of our variables have a VIF score of just above 1, it means that no further investigation is warranted and all correlation coeffiecients and p-values can be trusted.